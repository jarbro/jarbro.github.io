<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Why You No Have NTP?!</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://blog.jarbro.com/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//blog.jarbro.com/themes/casper/assets/css/screen.css?v=1498168230578" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="blog .jarbro" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Why You No Have NTP?!" />
    <meta property="og:description" content="A few months back I had to replace one of our switches.  Shortly afterwards I began getting complaints that users workstations clocks were off by a minute here, a minute there.  It wasn&amp;#8217;t affecting the entire network, only a small subset of users. At first I was convinced" />
    <meta property="og:url" content="http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html" />
    <meta property="article:published_time" content="2017-06-07T00:00:00.000Z" />
    <meta property="article:tag" content="NETWORKING" />
    <meta property="article:tag" content="NTP" />
    <meta property="article:tag" content="SWITCHING" />
    <meta property="article:tag" content="PROCURVE" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Why You No Have NTP?!" />
    <meta name="twitter:description" content="A few months back I had to replace one of our switches.  Shortly afterwards I began getting complaints that users workstations clocks were off by a minute here, a minute there.  It wasn&amp;#8217;t affecting the entire network, only a small subset of users. At first I was convinced" />
    <meta name="twitter:url" content="http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "blog .jarbro",
    "author": {
        "@type": "Person",
        "name": "Jared Brodsky",
        "image": "https://avatars1.githubusercontent.com/u/3271673?v=3",
        "url": "http://blog.jarbro.com/author/jarbro/",
        "sameAs": "blog.jarbro.com",
        "description": "nothing to see here, move along."
    },
    "headline": "Why You No Have NTP?!",
    "url": "http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html",
    "datePublished": "2017-06-07T00:00:00.000Z",
    "keywords": "NETWORKING, NTP, SWITCHING, PROCURVE",
    "description": "A few months back I had to replace one of our switches.  Shortly afterwards I began getting complaints that users workstations clocks were off by a minute here, a minute there.  It wasn&amp;#8217;t affecting the entire network, only a small subset of users. At first I was convinced"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="blog .jarbro" href="http://blog.jarbro.com/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
</head>
<body class="post-template tag-NETWORKING tag-NTP tag-SWITCHING tag-PROCURVE nav-closed">

    

    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-NETWORKING tag-NTP tag-SWITCHING tag-PROCURVE">

        <header class="post-header">
            <h1 class="post-title">Why You No Have NTP?!</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-06-07">07 June 2017</time>  on <a href="http://blog.jarbro.com/tag/NETWORKING/">NETWORKING</a>, <a href="http://blog.jarbro.com/tag/NTP/">NTP</a>, <a href="http://blog.jarbro.com/tag/SWITCHING/">SWITCHING</a>, <a href="http://blog.jarbro.com/tag/PROCURVE/">PROCURVE</a>
            </section>
        </header>

        <section class="post-content">
            <div class="paragraph">
<p>A few months back I had to replace one of our switches.  Shortly afterwards I began getting complaints that users workstations clocks were off by a minute here, a minute there.  It wasn&#8217;t affecting the entire network, only a small subset of users.</p>
</div>
<div class="paragraph">
<p>At first I was convinced it was my firewall blocking NTP traffic, but packet captures at the edge turned up nothing.  Packet captures from an affected host showed the outbound NTP requests going out, but no NTP response.</p>
</div>
<div class="paragraph">
<p>After some additional physical network testing I narrowed it down to an HP Procurve V1810-48G switch which has a lovely feature called Auto DoS.</p>
</div>
<div class="paragraph">
<p>In a nutshell enabling Auto DoS will hose some of your network services.</p>
</div>
<div class="paragraph">
<p>A single checkbox started <strong>blackholing</strong> my NTP traffic and their documentation simply labels the box as <em>Select Enable to enable denial of service attack protection, or clear to disable DoS protection.</em> While it is disabled by default, for some reason, mine was <em>enabled</em>.</p>
</div>
<div class="paragraph">
<p>While I congratulate HP engineers for at least understanding the need for implementing security on L2, this particular implementation cost me a fair amount of time in troubleshooting and a huge headache.</p>
</div>
<div class="paragraph">
<p>Long story short</p>
</div>
<div class="paragraph">
<p>Disable Auto DoS and things should go back to normal.</p>
</div>
<div class="paragraph">
<p>For reference, this is what enabling Auto DoS actually does.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Auto DoS</p>
</div>
<div class="paragraph">
<p>Enable – Select to prevent receiving packets from the all attacks mentioned below (Default: Disabled).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prevent Land Attack – Prevents receiving packets with matching Source and Destination IP addresses.</p>
</li>
<li>
<p>Prevent TCP Blat Attack – TCP Source and Destination Port match</p>
</li>
<li>
<p>Prevent UDP Blat Attack – UDP Source and Destination Port match</p>
</li>
<li>
<p>Prevent Ping Of Death Attack – Prevents receiving ping packets with a size larger than 512 bytes through the use of fragments, which can target vulnerable systems.</p>
</li>
<li>
<p>Prevent Invalid TCP Flags Attack – Prevents receiving packets with invalid TCP flags. TCP Flag SYN set and Source Port less than 1024 or TCP Control Flags = 0 and * TCP Sequence Number = 0 or TCP Flags FIN, URG, and PSH set and TCP Sequence Number = 0 or TCP Flags SYN and FIN set.</p>
</li>
<li>
<p>Prevent TCP Fragment Attack – Drop IP Packets that have a TCP header less than 20 bytes.</p>
</li>
<li>
<p>Check First Fragment Only – Enable checking DOS attacks on IP first fragments</p>
</li>
<li>
<p>Prevent Smurf Attack – ICMP Echo packets (ping) to a broadcast IP address are dropped.</p>
</li>
<li>
<p>Prevent Ping Flood Attack – Prevents Ping Flood by limiting the number of ICMP Ping packets. The rate is 1000 ICMP packets per second.</p>
</li>
<li>
<p>Prevent Syn Flood Attack – A SYN flood attack sends TCP connections requests faster than a machine can process them. Setting this filter limits the rate of TCP connection requests.</p>
</li>
</ul>
</div>
</blockquote>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="http://blog.jarbro.com/author/jarbro/" style="background-image: url(https://avatars1.githubusercontent.com/u/3271673?v&#x3D;3)"><span class="hidden">Jared Brodsky's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="http://blog.jarbro.com/author/jarbro/">Jared Brodsky</a></h4>

                    <p>nothing to see here, move along.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">I ❤︎ NYC</span>
                    <span class="author-link icon-link"><a href="blog.jarbro.com">blog.jarbro.com</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Why%20You%20No%20Have%20NTP%3F!&amp;url=http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://blog.jarbro.com/2017/06/07/Why-You-No-Have-NTP.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'jarbro'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>


    </article>

</main>

<aside class="read-next">
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://blog.jarbro.com">blog .jarbro</a> &copy; 2017</section>
            <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
       
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

    <script type="text/javascript" src="//blog.jarbro.com/themes/casper/assets/js/jquery.fitvids.js?v=1498168230578"></script>
    <script type="text/javascript" src="//blog.jarbro.com/themes/casper/assets/js/index.js?v=1498168230578"></script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-71227-21', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
